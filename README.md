# Техническое задание: Telegram Bot для управления форвардными контрактами

## 1. Цель
Создать Telegram-бота для заключения, закрытия (включая частичное закрытие) и управления форвардными контрактами. Все данные должны сохраняться в БД.

---

## 2. Функционал для пользователей
### 2.1. Приветствие
- При старте бот отправляет сообщение:
- 
"Привет! Я помогаю управлять форвардными контрактами. Мои возможности:
Открытие/закрытие форвардов
Просмотр списка активных контрактов
Расчет форвардной цены
Помощь по командам"




### 2.2. Основное меню (кнопки)
- **Кнопки**:
1. Открыть форвард
2. Закрыть форвард
3. Список форвардов
4. Помощь

---

## 3. Сценарий: Открытие форварда
### 3.1. Шаги:
1. **Выбор актива** (кнопки: Gold, Silver, USD).
2. **Дата заключения**:
 - Пользователь вводит в формате `DD.MM.YYYY`.
 - Валидация: запрет ввода прошедших дат.
3. **Дата окончания**:
 - Рассчитывается автоматически: `Дата заключения + 92 дня`.
4. **Цена**:
 - Варианты ввода:
   - Непосредственный ввод суммы.
   - Для Gold/Silver: ввод даты (`DD.MM.YYYY`) и времени (`AM/PM` для Gold, `NOON` для Silver).
   - *Примечание*: После ввода даты/времени админ вручную устанавливает цену через админ-панель.
5. **Форвардная цена**:
 - Формула: `F = S * e^(r * t)`, где:
   - `S` — текущая цена актива
   - `r` — безрисковая ставка (берется из админской панели)
   - `t` — время до экспирации (в годах)
 - *Для USD формула не применяется — цена фиксируется вручную*.

---

## 4. Сценарий: Закрытие форварда
### 4.1. Шаги:
1. Пользователь выбирает контракт из списка активных.
2. **Тип закрытия**:
 - Полное закрытие.
 - Частичное закрытие:
   - Ввод суммы/процента для закрытия.
   - Обновление остатка в БД (поле `remaining_amount`).
3. После закрытия в БД обновляется статус контракта.

---

## 5. Админ-панель
### 5.1. Доступ
- Админ определяется по `user_id` в БД.
- **Доп. кнопки**:
5. Изменить/удалить форвард

### 5.2. Функционал:
- **Установка цены** для контрактов с отложенным вводом (по дате/времени).
- **Редактирование**:
- Изменение цены, дат, актива.
- Удаление контрактов.
- **Настройки**:
- Обновление безрисковой ставки (`r`).
- Просмотр всех контрактов (включая закрытые).

---

## 6. База данных
### 6.1. Таблица `forwards`
| Поле               | Тип          | Описание                          |
|---------------------|--------------|-----------------------------------|
| id                  | INT (PK)     | Уникальный ID контракта           |
| user_id             | INT          | ID пользователя                   |
| asset               | VARCHAR(10)  | Актив (Gold/Silver/USD)           |
| start_date          | DATE         | Дата заключения                   |
| end_date            | DATE         | Дата окончания                    |
| initial_price       | FLOAT        | Начальная цена (если введена)     |
| forward_price       | FLOAT        | Рассчитанная форвардная цена      |
| status              | VARCHAR(15)  | Статус (active/closed/partially)  |
| remaining_amount    | FLOAT        | Остаток (для частичного закрытия) |

---

## 7. Безопасность
- Редактирование/удаление контрактов — только для админов.
- Шифрование чувствительных данных (цены, user_id).
- Логирование действий админов.

---

## 8. Дополнительные требования
- **Список форвардов**:
- Фильтрация по активу/статусу.
- Отображение: ID, актив, даты, цена, статус.
- **Помощь**:
- Инструкция с примерами.
- Контакты поддержки.

---

## 9. Технологии
- Язык: Python (aiogram)
- БД: PostgreSQL
- Хостинг: Docker на AWS/Azure
